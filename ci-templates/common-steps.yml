parameters:
  OS: ''

steps:
- task: DotNetCoreCLI@2
  name: dotnetRestore
  displayName: Restore Dependencies
  inputs:
    command: restore
    projects: '**/*.csproj'

- task: DotNetCoreCLI@2
  name: dotnetBuild
  displayName: Compile Projects
  inputs:
    command: build
    projects: '**/*.csproj'
    arguments: '-c $(BuildConfiguration)'

- task: DotNetCoreCLI@2
  name: dotnetTest
  displayName: Run Unit Tests
  inputs:
    command: test
    projects: 'tests/**/*.csproj'
    - ${{ if eq(parameters.OS, 'Windows') }}:
      arguments: '--no-build -c $(buildConfiguration) --collect "Code coverage" --settings $(Build.SourcesDirectory)\CodeCoverage.runsettings'
    - ${{ if in(parameters.OS, 'Linux', 'MacOS') }}:
    ${{ if in(variables['Build.Reason'], 'Manual', 'Schedule') }}:
      arguments: '--no-build -c $(buildConfiguration)'
